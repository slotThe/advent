⟨Split⟩ ← •Import "../../util/bqn_util/util.bqn"
p‿w ← ⟨⊑,¯2⊸⊑⟩{•ParseFloat𝕎𝕩}¨ <' 'Split •FChars"../inputs/day09.txt"
xs ← ⟨1‿2,2‿0,0‿1⟩∾w⥊0

Ins ← { k𝕊j:
  ·‿i   ← j⊑xs
  ip‿in ← i⊑xs
  np‿nn ← in⊑xs
  xs ⟨i‿in,ip‿k,k‿nn⟩⌾(k‿i‿in⊸⊏)↩
}

Del ← { 𝕊i:
  p‿n  ← i⊑xs
  pp‿· ← p⊑xs
  ·‿nn ← n⊑xs
  xs ⟨¯1‿¯1,pp‿n,p‿nn⟩⌾(i‿p‿n⊸⊏)↩
}

Mov ← {
  𝕊0‿p: p;
  𝕊n‿i: 𝕊 ⟨n+1, 0⊑i⊑xs⟩
}

Sol ← { 𝕊·:
  ⌈´2⊑{
    𝕊 i‿st‿ps: 0=23|st?
      d ← Mov ¯7‿i
      ·‿n ← d⊑xs
      xs ¯1‿¯1⌾((i+1)⊸⊑)↩
      Del d
      ps (d+st⊸+)⌾((p|st-1)⊸⊑)↩
      ⟨n, st+1, ps⟩;
    𝕊 i‿st‿ps:
      st Ins i
      ·‿in  ← i⊑xs
      ·‿inn ← in⊑xs
      ⟨inn, st+1, ps⟩
  }•_while_{
    𝕊 i‿st‿ps: st≤w
  } ⟨2, 3, p⥊0⟩
}

Sol@ # ⇒ 405143

w ×⟜100↩ ⋄ xs ↩ ⟨1‿2,2‿0,0‿1⟩∾w⥊0 ⋄ @
Sol@ # ⇒ 3411514667
