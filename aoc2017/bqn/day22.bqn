âŸ¨Split,crâŸ© â† â€¢Import "../../util/bqn_util/util.bqn"
inp â† >â€¢FLines "../inputs/day22.txt"
start â† âŸ¨0, âŒŠ(â‰¢inp)Ã·2, Â¯1â€¿0âŸ©

Turn â† { # Given direction ğ•©, turn ğ•¨ steps to the right.
  ts â† âŸ¨Â¯1â€¿0, 0â€¿1, 1â€¿0, 0â€¿Â¯1âŸ©
  (4|ğ•¨+âŠ‘tsâŠ<ğ•©)âŠ‘ts
}

# Simulate a burst.
#   modâ€¿infectedTargetâ€¿TurnOffset ğ•Š infectCountâ€¿positionâ€¿direction
Sim â† { mâ€¿tâ€¿TO ğ•Š iâ€¿pâ€¿d:
  pv â† 0 h.Get p      # Don't keep track of clean (= 0) cells.
  nd â† (TO pv) Turn d
  p h.Set m|pv+1      # New value for p.
  âŸ¨i+t=pv, p+nd, ndâŸ©
}

# The easy part: clean = 0 and infected = 1.
h â† (â¥Šâ†•â‰¢inp)â€¢HashMap(â¥Š".#"âŠinp)
âŠ‘ âŸ¨2, 0, {ğ•Š0:Â¯1;ğ•©}âŸ© SimâŸ10_000 start # â‡’ 5460

# Clean = 0, weakened = 1, infected = 2, flagged = 3.
h â† (â¥Šâ†•â‰¢inp)â€¢HashMap(â¥Š". #"âŠinp)
âŠ‘ âŸ¨4, 1, -âŸœ1âŸ© SimâŸ10_000_000 start # â‡’ 2511702
