Turn â† { # Given direction ğ•©, turn ğ•¨ steps to the right.
  ts â† âŸ¨Â¯1â€¿0, 0â€¿1, 1â€¿0, 0â€¿Â¯1âŸ©
  (âŠ‘4|ğ•¨+tsâŠ<ğ•©)âŠ‘ts
}
# Simulate a burst.
#   modâ€¿infectedTargetâ€¿TurnOffset ğ•Š gridâ€¿infectCountâ€¿positionâ€¿direction
Sim â† { mâ€¿tâ€¿TO ğ•Š gâ€¿iâ€¿pâ€¿d:
  pv â† 0 g.Get p      # Don't keep track of clean (= 0) cells.
  nd â† (TO pv) Turn d
  p g.Set m|pv+1      # New value for p.
  âŸ¨g, i+t=pv, p+nd, ndâŸ©
}

inp â† >â€¢FLines "../inputs/day22.txt"
Start â† {âŸ¨(â¥Šâ†•â‰¢inp)â€¢HashMapğ•©, 0, âŒŠ(â‰¢inp)Ã·2, Â¯1â€¿0âŸ©}

# The easy part: clean = 0 and infected = 1.
1âŠ‘ âŸ¨2, 0, {ğ•Š0:Â¯1;ğ•©}âŸ© SimâŸ10_000 Start(â¥Š".#"âŠinp) # â‡’ 5460
# Clean = 0, weakened = 1, infected = 2, flagged = 3.
1âŠ‘ âŸ¨4, 1, -âŸœ1âŸ© SimâŸ10_000_000 Start(â¥Š". #"âŠinp)  # â‡’ 2511702
