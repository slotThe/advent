⟨Split⟩ ← •Import "../../util/bqn_util/util.bqn"
P ← { # Parse line
  f‿t ← '='Split𝕩 ⋄ f ¯1⊸↓↩ ⋄ t 2⊸↓↩
  (> ".#"⊸⊐¨ ∘ ('/'⊸Split))¨ f‿t
}
E ← { 𝕊 f‿t: (⥊⟨⌽˘,⊢⟩{𝕎𝕩}⌜(⍉⌽)⍟(↕4)f)⋈¨<t } # Expand
inp ← ∊∘(⊑¨)⊸/ ∾E∘P¨ •FLines "../inputs/day21.txt"
start ← >".#"⊸⊐¨⟨".#.", "..#", "###"⟩

Widen ← { k‿matches𝕊grid:
  n ← k÷˜≠grid
  ∾n‿n⥊{ 𝕊ixs:
    <1⊑⊑ (ixs⊑grid)⊸{𝕨≡⊑𝕩}¨⊸/matches
  }˘(⥊⋈⌜˜+⟜k⍟(↕n)0)+⌜↕k‿k
}
Sim ← {
  0=2|≠𝕩? ⟨2, {2=≠⊑𝕩}¨⊸/inp⟩ Widen 𝕩;
  0=3|≠𝕩? ⟨3, {3=≠⊑𝕩}¨⊸/inp⟩ Widen 𝕩
}

+´⥊ Sim⍟5  start # ⇒ 155
+´⥊ Sim⍟18 start # ⇒ 2449665
