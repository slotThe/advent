âŸ¨SplitâŸ© â† â€¢Import "../../util/bqn_util/util.bqn"
P â† { # Parse a line into fromâ€¿to pairs
  fâ€¿t â† '='Splitğ•© â‹„ f Â¯1âŠ¸â†“â†© â‹„ t 2âŠ¸â†“â†©
  >âˆ˜(".#"âŠ¸âŠÂ¨)âˆ˜('/'âŠ¸Split)Â¨ fâ€¿t
}
E â† { ğ•Š fâ€¿t: (â·â¥ŠâŸ¨âŒ½Ë˜,âŠ¢âŸ©{ğ•ğ•©}âŒœ(â‰âŒ½)âŸ(â†•4)f)â‹ˆÂ¨<t } # Expand to all of Dâ‚„
inp â† âˆ¾ Eâˆ˜PÂ¨ â€¢FLines "../inputs/day21.txt"

Widen â† { kâ€¿substs ğ•Š grid: # k, kÃ—k â†’ (k+1)Ã—(k+1) substitutions, grid
  âˆ¾{ ğ•Šsg: # A kÃ—k submatrix of `grid'
    1âŠ‘âŠ‘ (sgâ‰¡âŠ‘)Â¨âŠ¸/substs
  }Â¨ (2â¥Š<âŒŠkÃ·Ëœâ†•â‰ grid)âŠ”grid
}
Sim â† {
  0=2|â‰ ğ•©? âŸ¨2, {2=â‰ âŠ‘ğ•©}Â¨âŠ¸/inpâŸ© Widen ğ•©;
  0=3|â‰ ğ•©? âŸ¨3, {3=â‰ âŠ‘ğ•©}Â¨âŠ¸/inpâŸ© Widen ğ•©
}

start â† >".#"âŠ¸âŠÂ¨âŸ¨".#.", "..#", "###"âŸ©
+Â´â¥Š SimâŸ5  start # â‡’ 155
+Â´â¥Š SimâŸ18 start # â‡’ 2449665
