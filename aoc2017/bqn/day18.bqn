âŸ¨Split,crâŸ©â†â€¢Import"../../util/bqn_util/util.bqn"
inp â† â€¢ParseFloatâŠâŠ¢Â¨âˆ˜(' 'âŠ¸Split)Â¨â€¢FLines "../inputs/day18.txt"

V â† { 1=â€¢Type ğ•©? ğ•©; (âŠ‘ğ•©-"a")âŠ‘ğ•¨ } # [V]alue, ğ•¨=arr, ğ•©=el
_C â† { regs F _ğ•£ xâ€¿y: FâŸœ(regs V y)âŒ¾((âŠ‘x-"a")âŠ¸âŠ‘) regs } # [C]hange

# Simulate the instructions taking two arguments;
# these are the same for both parts.
SD â† { ğ•ŠâŸ¨ix,regs,insâ€¿xâ€¿yâŸ©:
  { ğ•Š"set": âŸ¨ix+1, regs âŠ¢_C xâ€¿yâŸ©;
    ğ•Š"add": âŸ¨ix+1, regs +_C xâ€¿yâŸ©;
    ğ•Š"mul": âŸ¨ix+1, regs Ã—_C xâ€¿yâŸ©;
    ğ•Š"mod": âŸ¨ix+1, regs {ğ•©|ğ•¨}_C xâ€¿yâŸ©;
    ğ•Š"jgz": (regs V x)>0? âŸ¨ix+(regs V y), regsâŸ©;
    ğ•Š"jgz": âŸ¨ix+1, regsâŸ©
  } ins
}

snd â† 0
One â† {
  ğ•ŠâŸ¨ix,regs,insâ€¿xâŸ©:
    { ğ•Š"snd": sndâ†©regs V x â‹„ âŸ¨ix+1, regsâŸ©;
      ğ•Š"rcv": snd!0=regs V x â‹„ âŸ¨ix+1, regsâŸ©
    } ins;
  SD ğ•©
}
{ğ•Šiâ€¿r: OneâŸ¨i,r,iâŠ‘inpâŸ©}â€¢_while_{ğ•Šiâ€¿Â·: (iâ‰¥0)âˆ§i<â‰ inp}âŠâ€¢CurrentErrorâŸ¨0,16â¥Š0âŸ© # â‡’ 9423

Two â† {
  ğ•ŠâŸ¨my,other,ix,regs,insâ€¿xâŸ©:
    { ğ•Š"snd":
        otherâˆ¾â†©regs V x
        âŸ¨my, other, ix+1, regsâŸ©;
      ğ•Š"rcv":
        qâ€¿qs â† {âŸ¨my,other,ix,regsâŸ©!âŸ¨âŸ©â‰¢ğ•© â‹„ 1(â†‘â‹ˆâ†“)ğ•©} my
        âŸ¨qs, other, ix+1, regs âŠ¢_C xâ€¿(âŠ‘q)âŸ©
    } ins;
  ğ•ŠâŸ¨my,other,ix,regs,inssâŸ©:
    âŸ¨my,otherâŸ©âˆ¾SDâŸ¨ix,regs,inssâŸ©
}

âŠ‘{ ğ•Šs1â€¿q0â€¿q1â€¿i1â€¿r1â€¿i2â€¿r2â€¿xs: # hahahahahahahahaha
  âŸ¨q0,q1,i1,r1âŸ© â†© TwoâŠâ€¢CurrentErrorâŸ¨q0,q1,i1,r1,i1âŠ‘xsâŸ©
  old0 â† â‰ q0
  âŸ¨q1,q0,i2,r2âŸ© â†© TwoâŠâ€¢CurrentErrorâŸ¨q1,q0,i2,r2,i2âŠ‘xsâŸ© # q0 and q1 swap here
  âŸ¨s1+old0<â‰ q0,q0,q1,i1,r1,i2,r2,xsâŸ©
}â€¢_while_{ ğ•ŠÂ·â€¿q0â€¿q1â€¿i1â€¿Â·â€¿i2â€¿Â·â€¿xs:
  Â¬âˆ§Â´âŸ¨q0â‰¡âŸ¨âŸ©, q1â‰¡âŸ¨âŸ©, "rcv"â‰¡âŠ‘i1âŠ‘xs, "rcv"â‰¡âŠ‘i2âŠ‘xsâŸ©
} âŸ¨0, âŸ¨âŸ©,âŸ¨âŸ©, 0,(15â¥Š0)âˆ¾0, 0,(15â¥Š0)âˆ¾1, inpâŸ© # â‡’ 7620
