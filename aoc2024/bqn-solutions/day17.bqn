âŸ¨IntsâŸ© â† â€¢Import "../../util/bqn_util/util.bqn"

# Using bit-vectors because we need u64's for this.
ToBV  â† { ğ•Šp: pğ•ŠâŸ¨âŸ©; 0ğ•Šr: rÂ«64â¥Š0; pğ•Šr: (âŒŠpÃ·2)ğ•Š(râˆ¾Ëœ2|p) }
XOR   â† â‰ 
ToNum â† 2âŠ¸Ã—âŠ¸+ËœÂ´âŒ½
Sft   â† { (ToNumğ•©)â¥ŠâŸœ0âŠ¸Â»ğ•¨ } # Right-shift ğ•¨ by the value of ğ•©
b1â†ToBV 1 â‹„ b2â†ToBV 2 â‹„ b3â†ToBV 3 â‹„ b7â†ToBV 7
âŸ¨a,Â·,Â·âŸ©â€¿ops â† 3(â†‘â‹ˆâ†“) ToBVÂ¨ Ints âˆ¾â€¢FLines"../inputs/day17.txt"

# Hand optimised from input: (ğ•© & 7 ^ 1) ^ (ğ•© Â» (ğ•© & 7 ^ 2)) & 7
Step â† { b7âˆ§(b1 XOR ğ•©âˆ§b7)XOR(ğ•© Sft (b2 XOR ğ•©âˆ§b7)) }
r â† âŸ¨âŸ©
{ râ†©râˆ¾<Stepğ•© â‹„ ğ•© Sft b3 }â€¢_while_(âˆ¨Â´) a
!"7,1,5,2,4,0,7,6,1"â‰¡ 1â†“âˆ¾âˆ¾','âŠ¸â‹ˆâˆ˜â€¢Reprâˆ˜ToNumÂ¨r

Two â† {
  { ğ•Šopsâ€¿prevs:
    âŸ¨Â¯1â†“ops, âˆ¾{ğ•Šp: {(Stepğ•©) â‰¡ Â¯1âŠ‘ops}Â¨âŠ¸/{(ToBVğ•©)âˆ¨ Â«âŸ3 p}Â¨â†•8}Â¨prevsâŸ©
  }â€¢_while_{ ğ•Šopsâ€¿Â·: âŸ¨âŸ©â‰¢ops } ğ•©â€¿âŸ¨ToBV 0âŸ©
}
!37222273957364â‰¡âŒŠÂ´ToNumÂ¨1âŠ‘Two ops
