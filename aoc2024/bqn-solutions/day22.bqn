âŸ¨IntsâŸ© â† â€¢Import "../../util/bqn_util/util.bqn"

BV  â† { ğ•Šp: pğ•ŠâŸ¨âŸ©; 0ğ•Šr: rÂ«64â¥Š0; pğ•Šr: (âŒŠpÃ·2)ğ•Š(râˆ¾Ëœ2|p) } # To bit-vector
Rst â† { ğ•©â¥ŠâŸœ0âŠ¸Â»ğ•¨ } # Right shift of bit-vector ğ•¨ by amount ğ•©
Lst â† { Â«âŸğ•© ğ•¨ }   # Left  shift of bit-vector ğ•¨ by amount ğ•©
XOR â† â‰ 

prune â† BV 16777215
Step â† { ğ•Šn:
  n â†© prune âˆ§ n XOR n Lst 6
  n â†© prune âˆ§ n XOR n Rst 5
  n â†© prune âˆ§ n XOR n Lst 11  # Returns n when done
}

inp â† BVÂ¨ Ints â€¢FChars"../inputs/day22.txt"
steps â† (2âŠ¸Ã—âŠ¸+ËœÂ´âŒ½)Â¨Â¨ StepâŸ(1+â†•2000)Â¨ inp
!13584398738â‰¡ +Â´ Â¯1âŠ¸âŠ‘Â¨ steps

# Combine hash-maps and apply ğ”½ to duplicate keys.
_merge â† { W _ğ•£ hms:
  { ğ•Šhm:
    { ğ•Škâ€¿v: k c.Set (v W 0 c.Get k) }Â¨ (hm.Keys@)â‹ˆÂ¨(hm.Values@)
  }Â¨hms
  c
}

two â† +_merge {
  hm â† â€¢HashMapËœâŸ¨âŸ©
  (4â†“ps) { iğ•Šw: Â¬hm.Has w? w hm.Set i;@ }Â¨ <Ë˜4â†•   1â†“-âŸœÂ»   psâ†10|ğ•©
  # assocs | add only first occurrence   | wins | diffs | prices
  hm
}Â¨steps
!1612â‰¡ âŒˆÂ´two.Values@
