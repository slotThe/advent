âŸ¨IxâŸ© â† â€¢Import "../../util/bqn_util/util.bqn"
inpâ†>â€¢FLines"../inputs/day06.txt"
startâ†âŸ¨âŠ‘Ix'^'=inp, Â¯1â€¿0âŸ©

Turn â† { # Given direction ğ•©, turn ğ•¨ steps to the right.
  ts â† âŸ¨Â¯1â€¿0, 0â€¿1, 1â€¿0, 0â€¿Â¯1âŸ©
  (âŠ‘4|ğ•¨+tsâŠ<ğ•©)âŠ‘ts
}
IB â† { râ€¿c ğ•Š xâ€¿y: (y<r)âˆ§(yâ‰¥0)âˆ§(x<c)âˆ§xâ‰¥0 }
Sim â† {
  hmâ†âŸ¨startâŸ©â€¢HashMapâŸ¨@âŸ©
  rc â† â‰¢>ğ•©
  ret â† (>ğ•©){
    grid ğ•Š pâ€¿d:
      hm.HasâŸ¨p+d,dâŸ©? "LOOP";
    grid ğ•Š pâ€¿d:
      np â† p+d
       rcâŠ¸IBâ—¶âŸ¨
       @                             # falling off
       { ğ•Š'#': âŸ¨p, 1 Turn dâŸ©;        # hitting head
         ğ•ŠÂ·: npâ€¿d âŠ£ âŸ¨np,dâŸ©hm.Set@    # continuing
       }âŠ‘âŸœgrid
       âŸ© np
  }â€¢_while_{ Â·ğ•Š"LOOP": 0; Â·ğ•Š@: 0; 1 }start
  âŸ¨ret, â·âŠ‘Â¨hm.Keys@âŸ©
}

path â† 1âŠ‘Sim <inp
!4758â‰¡â‰ path
!1670â‰¡â‰ "LOOP"âŠ¸â‰¡Â¨âŠ¸/âŠ‘âˆ˜SimÂ¨{<'#'âŒ¾(ğ•©âŠ¸âŠ‘)inp}Â¨path
