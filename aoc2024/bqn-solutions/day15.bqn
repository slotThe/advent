âŸ¨SplitF, IxâŸ© â† â€¢Import "../../util/bqn_util/util.bqn"
Start â† {âŠ‘Ix'@'=ð•©}

insâ€¿mvs â† {
  insâ€¿mvs â† âŸ¨âŸ©SplitF â€¢FLines"../inputs/day15.txt"
  âŸ¨>ins, (âŸ¨'^','>','v','<'âŸ©âŠâˆ¾mvs)âŠâŸ¨Â¯1â€¿0,0â€¿1,1â€¿0,0â€¿Â¯1âŸ©âŸ©
}

Sim â† { gridâ€¿posâ€¿dirs:
  { âŸ¨âŸ©â€¿âŸ¨âŸ©â€¿ds:   âŸ¨Start gridâŸ©â€¿âŸ¨âŸ©â€¿(1â†“ds);          # Change dir after wall hit
    âŸ¨âŸ©â€¿seenâ€¿ds:                                  # Change dir after moving
      {grid'.'âŒ¾((âŠ‘ð•©)âŠ¸âŠ‘)â†©}Â¨ksâ†(âŠ£â‹ˆâŠ‘âŸœgrid)Â¨seen
      {ð•Špâ€¿v: grid vâŒ¾((p+âŠ‘ds)âŠ¸âŠ‘)â†©}Â¨ks
      âŸ¨Start gridâŸ©â€¿âŸ¨âŸ©â€¿(1â†“ds);
    psâ€¿seenâ€¿ds: âŠ‘(<âŠ‘ps)âˆŠseen? âŸ¨1â†“ps, seen, dsâŸ©;  # Already explored
    psâ€¿seenâ€¿ds:                                  # Explore new position
      { '#': âŸ¨âŸ¨âŸ©,                 âŸ¨âŸ©,      dsâŸ©;  # Hit wall -> abort
        '.': âŸ¨1â†“ps,               seenâˆ¾<p, dsâŸ©;  # Walking on sunshine
        'O': âŸ¨(<np)        âˆ¾1â†“ps, seenâˆ¾<p, dsâŸ©;  # Box
        '[': âŸ¨âŸ¨np+0â€¿1 , npâŸ©âˆ¾1â†“ps, seenâˆ¾<p, dsâŸ©;  # BBooxx
        ']': âŸ¨âŸ¨np+0â€¿Â¯1, npâŸ©âˆ¾1â†“ps, seenâˆ¾<p, dsâŸ©
      }gridâŠ‘Ëœ npâ† (âŠ‘ds)+ pâ†âŠ‘ps
  }â€¢_while_{ Â·â€¿Â·â€¿ds: âŸ¨âŸ©â‰¢ds } âŸ¨posâŸ©â€¿âŸ¨âŸ©â€¿dirs
  grid                                            # return the finished grid
}
Solve â† { +Â´{ð•Šyâ€¿x: x+yÃ—100}Â¨ IxâˆŠâŸœ'O'â€¿'[' SimâŸ¨ð•©, Start ð•©, mvsâŸ© }

!1552463â‰¡Solve ins
!1554058â‰¡Solve (âˆ¾{'O':"[]"; '@':"@."; ð•©â€¿ð•©}Â¨)Ë˜ins
